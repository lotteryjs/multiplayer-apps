# æŽ¢ç´¢ Golang é«˜å®žæ—¶ã€åˆ†å¸ƒå¼åº”ç”¨æœåŠ¡ç«¯ç¼–ç¨‹(ç²¾ç¥ž>æ€æƒ³>æŠ€æœ¯)

`5G æ—¶ä»£çš„åˆ°ä¸´ï¼Œé«˜å®žæ—¶åº”ç”¨åº”è¯¥ä¼šæœ‰æ‰€çˆ†å‘â€¦â€¦`

æŠ€æœ¯

* ç”Ÿäº§å·¥å…·ï¼Œå°±åƒæ–§å­ã€é“²å­ä¸€æ ·
* å¼€å‘è¯­è¨€ã€æ¡†æž¶éƒ½æ˜¯æŠ€æœ¯ï¼ŒåŠªåŠªåŠ›å­¦ä¹ å¤§å¤šéƒ½å¯ä»¥æŽŒæ¡

æ€æƒ³

* æ¥è‡ªäºŽå¸¸å¹´ç´¯æœˆå¯¹æŠ€æœ¯çš„ç§¯ç´¯å’Œç†è§£
* åˆç†çš„è®¾è®¡ã€æž¶æž„ç»éªŒã€æ¥è‡ªäºŽä¸æ–­çš„æŠ€æœ¯å®žè·µå’Œæ€»ç»“


ç²¾ç¥ž

* ä¸å†å±€é™äºŽç‰¹å®šçš„æŠ€æœ¯ä½“ç³»ä¸Žæ€æƒ³ä½“ç³»
* å‡­å€Ÿç›´è§‰ï¼Œèƒ½å¤Ÿå¿«é€ŸæŠ“ä½é—®é¢˜çš„æœ¬è´¨ï¼Œåœ¨ä¼—å¤šçº·æ‰°ä¸­åšå‡ºæ­£ç¡®é€‰æ‹©

ç”»å›¾å·¥å…·
  * [draw.io](https://www.draw.io/)
  * [ç™¾åº¦è„‘å›¾](https://naotu.baidu.com/)

### æœ¬ç¬”è®°ðŸ“’é˜…è¯»å‰ç½®çŸ¥è¯†

* æ„Ÿå…´è¶£å°±å¥½(ä¸æ‡‚çš„çŸ¥è¯† `Google` éƒ½ä¼šç»™ä½ ðŸ†™)
* åŸºæœ¬çš„æœåŠ¡ç«¯çŸ¥è¯†(æœ€å¥½æœ‰ Golang åŸºç¡€)
* æœ‰ Docker çŸ¥è¯†çš„è¯ï¼Œå‡ ä¹Žæ‰€æœ‰çš„å®žéªŒçŽ¯å¢ƒä½ éƒ½èƒ½å¿«é€Ÿçš„æž„é€ å‡ºæ¥

æœ¬ç³»åˆ—æ•™ç¨‹å°†ä»¥ [Nano](https://github.com/lonng/nano)(Lightweight, facility, high performance golang based game server framework) é¡¹ç›®ä¸ºæŽ¢ç´¢å¯¹è±¡ã€‚

* å®ƒæ˜¯ä¸€ä¸ªè½»é‡çº§çš„é¡¹ç›®ï¼Œå¯ä»¥å¾ˆå¥½çš„è®©æˆ‘ä»¬å…¥é—¨ ` Golang é«˜å®žæ—¶ Web åº”ç”¨`
* é‡é‡çº§ MMORPG æ¡†æž¶ç›®å‰ä¸åœ¨æ­¤è®¨è®ºèŒƒå›´å†…ðŸ¤£

Server ç«¯é¡¹ç›®æºç åˆ†æžå¯¹è±¡
  * [go-websocket](https://github.com/owenliang/go-websocket)
  * [go-push](https://github.com/owenliang/go-push)
  * [NanoServer](https://github.com/lonng/nanoserver)
  * å¤§å®¶ä¹Ÿå¯ä»¥ç›´æŽ¥çœ‹æºç å­¦ä¹ ï¼Œä¸ç”¨ç®¡æˆ‘ä¸‹é¢ðŸ‘‡çš„åºŸè¯ðŸ¤£ï¼ˆå¿«é€Ÿåº”ç”¨äºŽè‡ªå·±ä¸šåŠ¡çº¿æ‰æ˜¯æœ€é‡è¦çš„ï¼‰

ä¸ºä»€ä¹ˆé€‰æ‹© Nanoï¼Ÿ

* å¾ˆå¤šé¡¹ç›®å¾ˆç¾Žï¼Œä½†å¹¶æ²¡æœ‰æä¾›ä¸€ä¸ªåˆé€‚(å¤ªå¤§ or å¤ªå°)çš„ã€å®Œæ•´çš„ã€å¯åº”ç”¨äºŽç”Ÿäº§çš„çš„ä¸šåŠ¡ç¤ºä¾‹(ä¹Ÿè®¸æ˜¯æˆ‘æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„ðŸ¤¦â€â™€ï¸)

é’ˆå¯¹ Apkï¼š[Androidé€†å‘ç ´è§£ï¼šAndroid Killerä½¿ç”¨](https://www.jianshu.com/p/61a93a6c0c1b)

ç”±äºŽå®¢æˆ·ç«¯å¹¶æ²¡æœ‰å¼€æºï¼ˆæ¯”è¾ƒè›‹ç–¼ðŸ¤¦â€â™€ï¸ï¼‰

æˆ‘è¿™è¾¹ä¼šé™†é™†ç»­ç»­ä½¿ç”¨ [Cocos Creator](https://www.cocos.com/creator) åŽ»å¼€å‘ä¸€å¥—å®Œæ•´çš„å®¢æˆ·ç«¯å¹¶ä¸”å¼€æºã€‚

### å¿«é€Ÿä¸Šæ‰‹ GO & WebSocket

è§†é¢‘æ•™ç¨‹ï¼š[GOå®žçŽ°åƒä¸‡çº§WebSocketæ¶ˆæ¯æŽ¨é€æœåŠ¡](https://www.imooc.com/learn/1025)
* éžå¸¸å¥½çš„æ‰«ç›²æ•™ç¨‹
* å¦‚æžœä½ ä»Žæ¥æ²¡æœ‰æŽ¥è§¦è¿‡ WebSocketï¼Œé‚£ä¹ˆä½ ä¸€å®šè¦çœ‹ä¸€ä¸‹

ç¤ºä¾‹æºç ï¼š[go-websocket](https://github.com/owenliang/go-websocket) & [go-push](https://github.com/owenliang/go-push)
* ä¸€äº› DevOps é¢å¤–è¯(ä¹Ÿè®¸ä½ ä¸éœ€è¦å…³æ³¨â€¦â€¦)
* å…³äºŽå¦‚ä½•ä¼˜é›…çš„éƒ¨ç½²(traffic,k8s,docker,swarmâ€¦â€¦è¯´å®žè¯ç›¸å…³å†…å®¹è¿˜æŒºå¤šçš„ðŸ¤¦â€â™€ï¸)
* æœ¬åœ°å¯ä»¥é‡‡ç”¨ [Vagrant + VirtualBox] æˆ– [Docker Machine + VirtualBox] å¿«é€Ÿæ­å»ºå®žéªŒçŽ¯å¢ƒ,å¯ä»¥å‚çœ‹æˆ‘çš„[DevOps](https://github.com/Kirk-Wang/DevOps)ä»“åº“

ä»¥ä¸‹æ–‡å­—æ˜¯é’ˆå¯¹ä¸Šè¿°è§†é¢‘çš„è„±æ•å¤„ç†(`æ„Ÿè°¢å°é±¼å„¿å¤§ä½¬æä¾›å¦‚æ­¤é€šä¿—æ˜“æ‡‚çš„å…¥é—¨æ•™ç¨‹`)

#### ä»€ä¹ˆæ˜¯æŽ¨é€ç³»ç»Ÿï¼Ÿ

![push1](./websocket/images/push1.png)

#### å¼¹å¹•ç³»ç»Ÿçš„æŠ€æœ¯æŒ‘æˆ˜

æŠ€æœ¯å¤æ‚åº¦ï¼š

1 ä¸ªç›´æ’­é—´
* åœ¨çº¿äººæ•°ï¼š100ä¸‡
* å‘é€å¼¹å¹•ï¼š1000æ¡/ç§’
* æŽ¨é€é¢‘çŽ‡ï¼š100ä¸‡ * 1000æ¡/ç§’ = 10äº¿/ç§’

N ä¸ªç›´æ’­é—´
* æŽ¨é€é¢‘çŽ‡ï¼šN * 10äº¿/ç§’ (æœ‰ç‚¹å¯æ€•äº†ï¼Œæ€•è€æ¿é’±ä¸å¤ŸðŸ¤£â€¦â€¦)

#### æ‹‰æ¨¡å¼ä¸ŽæŽ¨æ¨¡å¼çš„åŒºåˆ«

æ‹‰æ¨¡å¼
* æœåŠ¡ç«¯æ•°æ®æ›´æ–°é¢‘çŽ‡ä½Žï¼Œåˆ™å¤§å¤šæ•°è¯·æ±‚æ˜¯æ— æ•ˆçš„
* åœ¨çº¿ç”¨æˆ·æ•°é‡å¤šï¼Œåˆ™æœåŠ¡ç«¯çš„æŸ¥è¯¢è´Ÿè½½é«˜
  * 100ä¸‡äººåŒæ—¶è½®è¯¢ï¼Œç›¸å½“äºŽ DDOS æ”»å‡»äº†ï¼Œå¯¹æœåŠ¡ç«¯ä¸å¯æŽ¥å—
* å®šæ—¶è½®è¯¢æ‹‰å–ï¼Œæ— æ³•æ»¡è¶³æ—¶æ•ˆæ€§è¦æ±‚

æŽ¨æ¨¡å¼
* ä»…åœ¨æ•°æ®æ›´æ–°æ—¶æ‰éœ€è¦æŽ¨é€
* éœ€è¦ç»´æŠ¤å¤§é‡çš„åœ¨çº¿é•¿è¿žæŽ¥
* æ•°æ®æ›´æ–°åŽå¯ä»¥ç«‹å³æŽ¨é€

åŸºäºŽ WebSocket æŽ¨é€
* æµè§ˆå™¨æ”¯æŒçš„socketç¼–ç¨‹ï¼Œè½»æ¾ç»´æŒæœåŠ¡ç«¯çš„é•¿è¿žæŽ¥
* åŸºäºŽTCPå¯é ä¼ è¾“ä¹‹ä¸Šçš„åè®®ï¼Œæ— éœ€å¼€å‘è€…å…³å¿ƒé€šè®¯ç»†èŠ‚
* æä¾›é«˜åº¦æŠ½è±¡çš„ç¼–ç¨‹æŽ¥å£ï¼Œä¸šåŠ¡å¼€å‘æˆæœ¬è¾ƒä½Ž

#### WebSocket åè®®ä¸Žäº¤äº’(`å¿…å¤‡åŸºç¡€`)

![websocket](./websocket/images/websocket.png)

ä¼ è¾“åŽŸç†

* å®¢æˆ·ç«¯ä¸ŽæœåŠ¡ç«¯ä¹‹é—´é¦–å…ˆè¦å®Œæˆä¸€æ¬¡æ¡æ‰‹ðŸ¤çš„æ“ä½œ
* æ¡æ‰‹æœ¬èº«æ˜¯åŸºäºŽ HTTP è°ƒç”¨å®Œæˆçš„
* å®¢æˆ·ç«¯é¦–å…ˆå‘é€ä¸€æ¡ HTTP è¯·æ±‚åˆ°æœåŠ¡ç«¯
  * è¯·æ±‚çš„ç‰¹æ®Šä¹‹å¤„åœ¨äºŽï¼Œå®ƒ Header é‡Œé¢å¸¦äº†ä¸€ä¸ª `upgrade` å­—æ®µ
  * å®ƒå‘Šè¯‰æœåŠ¡ç«¯ï¼Œæˆ‘æƒ³è¦å‡çº§ä¸º WebSocket åè®®
* æœåŠ¡ç«¯æ”¶åˆ°ä¹‹åŽï¼Œå°±ä¼šå“åº”ä¸€ä¸ªæ¡æ‰‹ðŸ¤çš„ç¡®è®¤ `switching`
  * `switching` çš„æ„æ€å°±æ˜¯è¯´ï¼ŒæœåŠ¡ç«¯å·²ç»å…è®¸ä½ å‘ `websocket` åè®®è½¬æ¢äº†
* ä¸€æ—¦å®Œæˆåå•†åŽ(å½“ç„¶ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯ä¸ŽæœåŠ¡ç«¯çš„åº•å±‚ TCP è¿žæŽ¥åº”è¯¥æ˜¯æ²¡æœ‰ä¸­æ–­çš„)
  * åè®®å‡çº§åŽï¼Œç»§ç»­å¤ç”¨ HTTP çš„åº•å±‚ Socket å®ŒæˆåŽç»­é€šè®¯
  * å®žé™…çš„ä¼ è¾“å•å…ƒæ˜¯ `message`
  * `websokcet` çš„ `message` æ˜¯æˆ‘ä»¬å®žé™…ç¼–ç¨‹çš„ä¸€ä¸ªåŸºæœ¬å•ä½
    * ä½†å®žé™…ä¸Šï¼Œ`message` åº•å±‚è¢«åˆ‡åˆ†ä¸ºå¤šä¸ª `frame` å¸§ä¼ è¾“
    * ç›®çš„æ˜¯ä»Žåè®®å±‚é¢ï¼Œå®ƒä¸èƒ½ä¼ è¾“ä¸€ä¸ªå¤§åŒ…ï¼Œå®ƒä¼šæŠŠå®ƒåˆ‡æˆä¸€ä¸ªä¸ªå°åŒ…åœ¨ç½‘ç»œä¸Šä¼ è¾“
    * ç¼–ç¨‹æ—¶åªéœ€æ“ä½œ `message`ï¼Œæ— éœ€å…³å¿ƒ frame
    * æ¡†æž¶åº•å±‚å®Œæˆ TCP ç½‘ç»œ I/Oï¼ŒWebSocket åè®®è§£æžï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒ
* æŽ¥ä¸‹æ¥ï¼Œ`å®¢æˆ·ç«¯`å°±å¯ä»¥å‘`æœåŠ¡ç«¯`å‘é€åŸºäºŽ`websocket`åè®®çš„ `message` (æ¶ˆæ¯)
* `æœåŠ¡ç«¯`ä¹Ÿå¯ä»¥ä¸»åŠ¨å‘`å®¢æˆ·ç«¯`å‘é€åŸºäºŽ`websocket`åè®®çš„ `message` (æ¶ˆæ¯)

#### æŠ“åŒ…è§‚å¯Ÿï¼Œå¼„æ¸…æ¥šæˆ‘ä»¬èƒ½åšæŽ¨é€çš„ä¾æ®(`éžå¸¸é‡è¦`)
* ä½¿ç”¨ Chrome å¼€å‘è€…å·¥å…·ï¼Œè§‚å¯Ÿ WebSocket é€šè®¯æµç¨‹
  * ä»Žæ¡æ‰‹åˆ°åŽç»­æ¶ˆæ¯çš„æ”¶å‘ï¼Œåˆ°åº•ç»åŽ†äº†ä»€ä¹ˆï¼Ÿ
* [go-websocket](https://github.com/owenliang/go-websocket)
  * Downä¸‹æ¥ï¼Œè‡ªå·±æ„Ÿå—ä¸€ä¸‹
  * åŽç»­ï¼Œæˆ‘ä¼šå¼„æˆä¸€ä¸ª Docker Image(ToDo)

![devtool-1](./websocket/images/devtool-1.png)

![devtool-2](./websocket/images/devtool-2.png)

#### æœåŠ¡ç«¯çš„æŠ€æœ¯é€‰åž‹ä¸Žè€ƒè™‘

NodeJS
* æœ€å¸¸å¬åˆ°çš„åš websocket é€šè®¯ï¼Œæ¯”è¾ƒæ™®åŠ
  * websocket æœ¬èº«æ˜¯æµè§ˆå™¨ç«¯çš„ä¸€ç§ç¼–ç¨‹ï¼Œå‰ç«¯åŒå­¦åˆæ¯”è¾ƒæ“…é•¿ NodeJSï¼Œç½‘ä¸Šåˆæœ‰å¾ˆå¤šåšå®¢åŽ»ä»‹ç»
* ä½†æ˜¯è¿™é‡Œé¢æœ‰ä¸ªé—®é¢˜
  * å•çº¿ç¨‹æ¨¡åž‹(è™½ç„¶å®ƒèƒ½å¤šè¿›ç¨‹)ï¼ŒæŽ¨é€æ€§èƒ½æœ‰é™
  * ä½†æ˜¯å¤šè¿›ç¨‹ä¸å¤ªé€‚åˆåšæŽ¨é€ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦éåŽ†åœ¨çº¿ç”¨æˆ·é›†åˆ
  * å¤šè¿›ç¨‹è¿žæŽ¥è¢«æ•£åˆ—åœ¨å¤šä¸ªè¿›ç¨‹ä¸Šï¼Œä¸æ”¾ä¾¿åš
  * æˆ‘ä»¬å¸Œæœ›è¿˜æ˜¯å¤šçº¿ç¨‹çš„æ¯”è¾ƒå¥½
* å®ƒæ˜¯è§£é‡Šæ€§è¯­è¨€

C/C++
* è½®å­å¤ªå°‘ï¼ˆå½“ç„¶ï¼Œå¦‚æžœä½ æœ‰å¾ˆå¼ºçš„ C/C++ èƒŒæ™¯ï¼Œé‚£ä¹ˆå®ƒæ˜¯æœ€å¥½çš„ðŸ¤£ï¼‰
  * TCP é€šè®¯ã€WebSocket åè®®å®žçŽ°æˆæœ¬é«˜

Go
* å¤šçº¿ç¨‹ï¼ŒåŸºäºŽåç¨‹æ¨¡åž‹å¹¶å‘
  * å¯¹äºŽå¼€å‘äººå‘˜éžå¸¸å‹å¥½ï¼Œèƒ½å¿«é€Ÿå†™å¥½å¤šçº¿ç¨‹ï¼Œé«˜å¹¶å‘çš„ç¨‹åº
  * ç¼–è¯‘æ€§è¯­è¨€ï¼Œæ„å‘³ç€å®ƒçš„è¿è¡Œé€Ÿåº¦å¹¶ä¸æ…¢
* æˆç†Ÿçš„ WebSocket æ ‡å‡†åº“ï¼Œæ— éœ€é€ è½®å­
  * æ»¡è¶³ç™¾ä¸‡ç”¨æˆ·æŽ¨é€çš„å¤„ç†
  * ä¹Ÿä¸éœ€è¦ç‰¹åˆ«å…³å¿ƒåè®®çš„ç»†èŠ‚
  * å¯ç›´æŽ¥è¿›å…¥åˆ°ä¸šåŠ¡ä¸­ï¼Œè¿™æ‰æ˜¯å¯¹æˆ‘ä»¬æœ€æœ‰ä»·å€¼çš„éƒ¨åˆ†

#### å®žçŽ° HTTP æœåŠ¡ç«¯
* WebSocket æ˜¯ HTTP åè®® Upgrade è€Œæ¥
* ä½¿ç”¨ http æ ‡å‡†åº“å¿«é€Ÿå®žçŽ°ç©ºæŽ¥å£ï¼š/ws
  * é…ç½®è·¯ç”±
  * ç›‘å¬æœåŠ¡

#### å®Œæˆ WebSocket æ¡æ‰‹
* ä½¿ç”¨ websocket.Upgrader å®Œæˆåè®®æ¡æ‰‹ï¼Œå¾—åˆ° WebSocket é•¿è¿žæŽ¥
  * æ¡æ‰‹å…·ä½“æ“ä½œäº¤ç»™æ ‡å‡†åº“åŽ»æ“ä½œ
    * upgrader := websocket.Upgrader{ CheckOrigin: func }
    * upgrader.Upgrade(w, r, nil)
* æ“ä½œ websocket api, è¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯ï¼Œç„¶åŽåŽŸæ ·å‘é€å›žåŽ»

#### å°è£… WebSocket

ç¼ºä¹å·¥ç¨‹åŒ–çš„è®¾è®¡
* å…¶å®ƒä»£ç æ¨¡å—ï¼Œæ— æ³•ç›´æŽ¥æ“ä½œ WebSocket è¿žæŽ¥
* WebSocket è¿žæŽ¥éžçº¿ç¨‹å®‰å…¨ï¼Œå¹¶å‘è¯»/å†™éœ€è¦åŒæ­¥æ‰‹æ®µ
  * ReadMessage & WriteMessage åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªä»£ç è°ƒç”¨

éšè—ç»†èŠ‚
* å°è£…Connectionç»“æž„ï¼Œéšè— WebSocket åº•å±‚è¿žæŽ¥
* å°è£…Connectionçš„APIï¼Œæä¾› Send/Read/Close ç­‰çº¿ç¨‹å®‰å…¨æŽ¥å£
* è¿™é‡Œä¼šæœ‰ç¼–ç ä¸Žæ€è€ƒçš„è„‘å›¾(ToDo)

APIåŽŸç†
* SendMessage å°†æ¶ˆæ¯æŠ•é€’åˆ° out channel
* ReadMessage ä»Ž in channel è¯»å–æ¶ˆæ¯
* channel æ˜¯çº¿ç¨‹å®‰å…¨çš„

å†…éƒ¨åŽŸç†
* å¯åŠ¨è¯»åç¨‹ï¼Œå¾ªçŽ¯è¯»å–WebSocketï¼Œå°†æ¶ˆæ¯æŠ•é€’åˆ° in channel
* å¯åŠ¨å†™åç¨‹ï¼Œå¾ªçŽ¯è¯»å– out channelï¼Œå°†æ¶ˆæ¯å†™ç»™WebSocket

#### åƒä¸‡çº§å¼¹å¹•ç³»ç»Ÿçš„æž¶æž„ç§˜å¯† 

åˆ†æžæŠ€æœ¯éš¾ç‚¹ï¼š

3ä¸ªæ€§èƒ½ç“¶é¢ˆ
* å†…æ ¸ç“¶é¢ˆ
* é”ç“¶é¢ˆ
* CPUç“¶é¢ˆ

å†…æ ¸ç“¶é¢ˆ
* æŽ¨é€é‡å¤§ï¼š100ä¸‡åœ¨çº¿ * 10æ¡/ç§’ = 1000ä¸‡æ¡/ç§’
* linux å†…æ ¸å‘é€ TCP çš„æžé™åŒ…é¢‘ â‰ˆ 100ä¸‡æ¡/ç§’

é”ç“¶é¢ˆ
* éœ€è¦ç»´æŠ¤åœ¨çº¿ç”¨æˆ·é›†åˆï¼ˆ100ä¸‡åœ¨çº¿ï¼‰ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå­—å…¸ç»“æž„
* æŽ¨é€æ¶ˆæ¯å³éåŽ†æ•´ä¸ªé›†åˆï¼Œé¡ºåºå‘é€æ¶ˆæ¯ï¼Œè€—æ—¶æžé•¿
* æŽ¨é€æœŸé—´ï¼Œå®¢æˆ·ç«¯ä»æ—§æ­£å¸¸ä¸Š/ä¸‹çº¿ï¼Œæ‰€ä»¥é›†åˆéœ€è¦ä¸Šé”
  * ä¸Šé”æœŸé—´ï¼Œå®¢æˆ·ç«¯æ— æ³•æ­£å¸¸ä¸Š/ä¸‹çº¿é—®é¢˜(æ‹¿ä¸åˆ°é”)ï¼Ÿ

CPU ç“¶é¢ˆ
* æµè§ˆå™¨æœåŠ¡ç«¯é€šå¸¸é‡‡å– json æ ¼å¼é€šè®¯
* json ç¼–ç éžå¸¸è€—è´¹ CPU èµ„æº
* å‘ 100 ä¸‡åœ¨çº¿æŽ¨é€ä¸€æ¬¡ï¼Œåˆ™éœ€100ä¸‡æ¬¡ json encode
  * å¹³æ—¶1000ï¼Œ2000 QPS åŽ‹æ ¹æ„Ÿå—ä¸å‡ºæ¥

æŠ€æœ¯éš¾ç‚¹çš„è§£å†³æ–¹æ¡ˆ

å†…æ ¸ç“¶é¢ˆ-ä¼˜åŒ–åŽŸç†
* å‡å°‘ç½‘ç»œå°åŒ…çš„å‘é€
  * ç½‘ç»œå°åŒ…ï¼ˆå‡ ç™¾å­—èŠ‚çš„å°±ç®—æ˜¯ç½‘ç»œä¸Šçš„å°åŒ…ï¼‰
  * ç½‘ç»œå°åŒ…ï¼Œå¯¹å†…æ ¸ä»¥åŠç½‘ç»œä¸Šçš„ä¸­é—´è®¾å¤‡éƒ½ä¼šé€ æˆä¸€ä¸ªå¤„ç†çš„åŽ‹åŠ›

å†…æ ¸ç“¶é¢ˆ-ä¼˜åŒ–æ–¹æ¡ˆ
* å°†åŒä¸€ç§’å†…çš„ N æ¡æ¶ˆæ¯ï¼Œåˆå¹¶æˆä¸€æ¡æ¶ˆæ¯
* åˆå¹¶åŽï¼Œæ¯ç§’æŽ¨é€çš„æ¬¡æ•°åªç­‰äºŽåœ¨çº¿è¿žæŽ¥æ•°
  * 100ä¸‡åœ¨çº¿
    * 10æ¡/ç§’ --> å°† 10 æ¡åˆå¹¶æˆä¸€æ¡
    * 20æ¡/ç§’ --> å°† 20 æ¡åˆå¹¶æˆä¸€æ¡
  * è¿™æ ·åªéœ€è¦æŽ¨100ä¸‡æ¬¡

é”ç“¶é¢ˆ-ä¼˜åŒ–åŽŸç†
* å¤§æ‹†å°

é”ç“¶é¢ˆ-ä¼˜åŒ–æ–¹æ¡ˆ
* è¿žæŽ¥æ‰“æ•£åˆ°å¤šä¸ªé›†åˆä¸­ï¼Œæ¯ä¸ªé›†åˆæœ‰è‡ªå·±çš„é”
* å¤šçº¿ç¨‹å¹¶å‘æŽ¨é€å¤šä¸ªé›†åˆï¼Œé¿å…é”ç«žäº‰
  * æŽ¨é€çš„è¿žæŽ¥çš„é›†åˆä¸åŒï¼Œæ²¡æœ‰é”çš„ç«žäº‰å…³ç³»
* è¯»å†™é”å–ä»£äº’æ–¥é”ï¼Œå¤šä¸ªæŽ¨é€ä»»åŠ¡å¯ä»¥å¹¶å‘éåŽ†ç›¸åŒçš„é›†åˆ
  * ç»™é›†åˆä¸Šçš„é”æ˜¯è¯»å†™é”
  * è¦å¹¶å‘æŽ¨é€ä¸¤æ¡æ¶ˆæ¯çš„æ—¶å€™ï¼Œä¸¤ä¸ªçº¿ç¨‹éƒ½å¯ä»¥åŠ åˆ°è¯»é”ï¼Œå®ƒä»¬åŒæ—¶éåŽ†åŒæ ·çš„é›†åˆï¼ŒæŠŠå„è‡ªçš„æ¶ˆæ¯æŽ¨é€å‡ºåŽ»

CPU-ä¼˜åŒ–åŽŸç†
* å‡å°‘é‡å¤è®¡ç®—

CPU-ä¼˜åŒ–æ–¹æ¡ˆ
* jsonç¼–ç å‰ç½®ï¼Œ1æ¬¡æ¶ˆæ¯ç¼–ç  + 100ä¸‡æ¬¡æŽ¨é€
* æ¶ˆæ¯åˆå¹¶å‰ç½®ï¼ŒNæ¡æ¶ˆæ¯åˆå¹¶åŽåªç¼–ç ä¸€æ¬¡

![å•æœºæž¶æž„](./websocket/images/single-arc.png)

åˆ†å¸ƒå¼æž¶æž„

å•æœºç“¶é¢ˆ
* ç»´æŠ¤æµ·é‡é•¿è¿žæŽ¥ä¼šèŠ±è´¹ä¸å°‘å†…å­˜
* æ¶ˆæ¯æŽ¨é€é¡ºæ—¶ä¼šæ¶ˆè€—å¤§é‡çš„CPUèµ„æº
* æ¶ˆæ¯æŽ¨é€çž¬æ—¶å¸¦å®½é«˜è¾¾400~600MB(4-6Gbits)ï¼Œæ˜¯ä¸»è¦ç“¶é¢ˆï¼
  * ä¸€èˆ¬çš„æœåŠ¡å™¨ï¼Œå®ƒçš„ç½‘å¡åªèƒ½è·‘åˆ° 100 MB(ä¹Ÿå°±æ˜¯è¯´æ˜¯ä¸€ä¸ªåƒå…†ç½‘å¡)
  * å¦‚æžœè¦è·‘åˆ°400~600MBï¼Œéœ€è¦ä¸‡å…†ç½‘å¡

æ‰€ä»¥ï¼Œä¸ºäº†æ‰©å±•ï¼Œæˆ‘ä»¬éœ€è¦åˆ†å¸ƒå¼æž¶æž„

æˆ‘ä»¬æŠŠåˆšåˆšå¼€å‘çš„è¿™ä¸ªç¨‹åºå«åšç½‘å…³

é¦–å…ˆï¼ŒæŠŠç½‘å…³åšæˆä¸€ä¸ªé›†ç¾¤
* éƒ¨ç½²å¤šä¸ªèŠ‚ç‚¹
* å‰é¢åšäº†è´Ÿè½½å‡è¡¡åŽï¼Œå°±ä¼šæŠŠè¿žæŽ¥æ‰“ç®—åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œå°±å®Œæˆäº†ç½‘å…³å±‚çš„æ¨ªå‘æ‰©å±•
* é—®é¢˜æ˜¯ï¼Ÿå½“æˆ‘ä»¬æŽ¨é€ä¸€ä¸ªæ¶ˆæ¯å‡ºåŽ»çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸çŸ¥é“å“ªä¸€ä¸ªç›´æ’­é—´åœ¨å“ªä¸€ä¸ªç½‘å…³èŠ‚ç‚¹ä¸Š
  * æœ€ç®€å•çš„æ–¹å¼æ˜¯æŠŠæ¶ˆæ¯å¹¿æ’­ç»™æ‰€æœ‰çš„ç½‘å…³èŠ‚ç‚¹
  * éƒ½åŽ»å„è‡ªåŽ»åšåˆ¤æ–­ï¼Œå„è‡ªåŽ»åšæŽ¨é€


![ç½‘å…³é›†ç¾¤æž¶æž„](./websocket/images/arc2.png)

æ‰€ä»¥è¿™é‡Œæ¶‰åŠä¸€ä¸ªå¾€ç½‘å…³å±‚çš„ä¸€ä¸ªå¹¿æ’­ï¼Œè°æ¥åšï¼Ÿé€»è¾‘é›†ç¾¤

é€»è¾‘é›†ç¾¤
* åŸºäºŽ HTTP/2 åè®®å‘ gateway é›†ç¾¤åˆ†å‘æ¶ˆæ¯
  * HTTP/2 æ”¯æŒè¿žæŽ¥å¤ç”¨ï¼Œç”¨ä½œ RPC æ€§èƒ½æ›´åŠ 
    * èƒ½åœ¨å•ä¸ªçš„é•¿è¿žæŽ¥ä¸Šåšé«˜åžåçš„è¯·æ±‚ï¼Œåº”ç­”å¤„ç†

* åŸºäºŽ HTTP/1 åè®®å¯¹å¤–æä¾›æŽ¨é€ API
  * HTTP/1 æ›´åŠ æ™®åŠï¼Œå¯¹ä¸šåŠ¡æ–¹æ›´åŠ å‹å¥½
  * ä¸šåŠ¡æ–¹è°ƒç”¨æŽ¥å£ï¼Œå°±èƒ½æŠŠæ¶ˆæ¯æŽ¨é€å‡ºåŽ»

æ•´ä½“æž¶æž„

![æ•´ä½“æž¶æž„](./websocket/images/arc3.png)

--------------------------------


### Nano åŸºæœ¬æœ¯è¯­è„‘å›¾
è„‘å›¾æ˜¯æ ¹æ® [å¦‚ä½•æž„å»ºä½ çš„ç¬¬ä¸€ä¸ªnanoåº”ç”¨](https://github.com/lonng/nano/blob/master/docs/get_started_zh_CN.md) æ¥æ•´ç†çš„ã€‚

![nano-get-started](images/nano-get-started.png)

### NanoServer ä¸šåŠ¡è¡¨ç»“æž„

**[TABLES-->>](https://lotteryjs.github.io/golang-server-dev/nanoserver-tables.html)**

![tables](./images/nanoserver-tables.png)